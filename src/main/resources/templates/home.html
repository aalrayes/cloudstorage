<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/bootstrap.min.css}">
        <link rel="icon" th:href="@{/icon/cloud-network.svg}" type="image/icon type">
        <title>Home - SuperDuperDrive</title>
    </head>
    <body class="p-3 mb-2 bg-light text-black">
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <svg height="30pt" viewBox="0 0 479.98038 479" width="30pt" xmlns="http://www.w3.org/2000/svg"><path d="m127.917969 328.355469c0 8.839843 7.164062 16 16 16 8.835937 0 16-7.160157 16-16" fill="#00aeef"/><path d="m159.917969 432.355469c0 8.839843-7.164063 16-16 16-8.835938 0-16-7.160157-16-16 0-8.835938 7.164062-16 16-16 8.835937 0 16 7.164062 16 16zm0 0" fill="#00aeef"/><path d="m471.917969 232.355469c0-53.019531-42.980469-96-96-96-.960938 0-1.839844 0-2.800781.082031 12.933593-54.664062-19.878907-109.71875-74.113282-124.355469-54.230468-14.632812-110.285156 16.445313-126.605468 70.195313-18.492188-17.8125-45.839844-22.859375-69.472657-12.820313-23.632812 10.039063-38.988281 33.222657-39.007812 58.898438-.023438 9.613281 2.136719 19.105469 6.320312 27.761719-41.691406 12.734374-67.789062 54.0625-61.359375 97.183593 6.429688 43.117188 43.445313 75.039063 87.039063 75.054688v-40h288v39.601562c49.734375-4.128906 87.996093-45.695312 88-95.601562zm-88 32h-288v-80h288zm0 0" fill="#00aeef"/><path d="m383.917969 264.355469h-288v-80h288zm0 0" fill="#898890"/><path d="m159.917969 224.355469c0 8.839843-7.164063 16-16 16-8.835938 0-16-7.160157-16-16 0-8.835938 7.164062-16 16-16 8.835937 0 16 7.164062 16 16zm0 0" fill="#f1f2f2"/><path d="m383.917969 368.355469h-288v-80h288zm0 0" fill="#898890"/><path d="m159.917969 328.355469c0 8.839843-7.164063 16-16 16-8.835938 0-16-7.160157-16-16 0-8.835938 7.164062-16 16-16 8.835937 0 16 7.164062 16 16zm0 0" fill="#f1f2f2"/><path d="m383.917969 472.355469h-288v-80h288zm0 0" fill="#898890"/><path d="m159.917969 432.355469c0 8.839843-7.164063 16-16 16-8.835938 0-16-7.160157-16-16 0-8.835938 7.164062-16 16-16 8.835937 0 16 7.164062 16 16zm0 0" fill="#f1f2f2"/><g fill="#231f20"><path d="m382.75 128.582031c.777344-5.375 1.167969-10.796875 1.167969-16.226562-.0625-53.273438-37.644531-99.128907-89.867188-109.65625-52.222656-10.527344-104.632812 17.1875-125.332031 66.273437-25.5625-17.480468-59.433594-16.675781-84.140625 1.996094-24.703125 18.675781-34.71875 51.042969-24.875 80.402344-36.355469 14.875-59.996094 50.378906-59.69921875 89.652344.29296875 39.277343 24.46093775 74.421874 61.03515575 88.75 4.117188 1.601562 8.753907-.433594 10.359376-4.550782 1.605468-4.121094-.433594-8.757812-4.550782-10.363281-31.730468-12.425781-52.125-43.570313-50.824218-77.621094 1.304687-34.054687 24.011718-63.554687 56.597656-73.519531 2.234375-.6875 4.058594-2.316406 4.988281-4.457031.933594-2.144531.882813-4.585938-.140625-6.6875-3.667969-7.546875-5.566406-15.828125-5.550781-24.21875.019531-22.472657 13.460937-42.757813 34.148437-51.539063 20.683594-8.78125 44.617188-4.359375 60.796875 11.238282 2.011719 1.925781 4.878907 2.667968 7.574219 1.960937 2.695312-.710937 4.824219-2.773437 5.625-5.441406 15.082031-49.597657 66.820312-78.261719 116.867188-64.75 50.046874 13.507812 80.332031 64.316406 68.40625 114.765625-.59375 2.488281.042968 5.113281 1.710937 7.054687 1.65625 1.960938 4.164063 2.992188 6.71875 2.761719.738281-.050781 1.394531-.050781 2.152344-.050781 41.453125-.035157 77.308593 28.859375 86.085937 69.371093 8.773438 40.511719-11.910156 81.65625-49.660156 98.773438-2.667969 1.144531-4.507812 3.640625-4.808594 6.523438-.300781 2.886718.980469 5.707031 3.355469 7.375 2.371094 1.667968 5.464844 1.921874 8.074219.664062 43.433594-19.714844 67.886718-66.449219 59.328125-113.371094-8.5625-46.921875-47.945313-82.003906-95.542969-85.109375zm0 0"/><path d="m383.917969 176.355469h-288c-4.417969 0-8 3.582031-8 8v80c0 4.417969 3.582031 8 8 8h288c4.417969 0 8-3.582031 8-8v-80c0-4.417969-3.582031-8-8-8zm-8 80h-272v-64h272zm0 0"/><path d="m343.917969 200.355469h16v16h-16zm0 0"/><path d="m311.917969 200.355469h16v16h-16zm0 0"/><path d="m279.917969 200.355469h16v16h-16zm0 0"/><path d="m247.917969 200.355469h16v16h-16zm0 0"/><path d="m215.917969 200.355469h16v16h-16zm0 0"/><path d="m343.917969 232.355469h16v16h-16zm0 0"/><path d="m311.917969 232.355469h16v16h-16zm0 0"/><path d="m279.917969 232.355469h16v16h-16zm0 0"/><path d="m247.917969 232.355469h16v16h-16zm0 0"/><path d="m215.917969 232.355469h16v16h-16zm0 0"/><path d="m183.917969 200.355469h16v16h-16zm0 0"/><path d="m183.917969 232.355469h16v16h-16zm0 0"/><path d="m143.917969 248.355469c13.253906 0 24-10.742188 24-24 0-13.253907-10.746094-24-24-24-13.253907 0-24 10.746093-24 24 0 13.257812 10.746093 24 24 24zm0-32c4.417969 0 8 3.582031 8 8s-3.582031 8-8 8-8-3.582031-8-8 3.582031-8 8-8zm0 0"/><path d="m383.917969 280.355469h-288c-4.417969 0-8 3.582031-8 8v80c0 4.417969 3.582031 8 8 8h288c4.417969 0 8-3.582031 8-8v-80c0-4.417969-3.582031-8-8-8zm-8 80h-272v-64h272zm0 0"/><path d="m343.917969 304.355469h16v16h-16zm0 0"/><path d="m311.917969 304.355469h16v16h-16zm0 0"/><path d="m279.917969 304.355469h16v16h-16zm0 0"/><path d="m247.917969 304.355469h16v16h-16zm0 0"/><path d="m215.917969 304.355469h16v16h-16zm0 0"/><path d="m343.917969 336.355469h16v16h-16zm0 0"/><path d="m311.917969 336.355469h16v16h-16zm0 0"/><path d="m279.917969 336.355469h16v16h-16zm0 0"/><path d="m247.917969 336.355469h16v16h-16zm0 0"/><path d="m215.917969 336.355469h16v16h-16zm0 0"/><path d="m183.917969 304.355469h16v16h-16zm0 0"/><path d="m183.917969 336.355469h16v16h-16zm0 0"/><path d="m143.917969 352.355469c13.253906 0 24-10.742188 24-24 0-13.253907-10.746094-24-24-24-13.253907 0-24 10.746093-24 24 0 13.257812 10.746093 24 24 24zm0-32c4.417969 0 8 3.582031 8 8s-3.582031 8-8 8-8-3.582031-8-8 3.582031-8 8-8zm0 0"/><path d="m383.917969 384.355469h-288c-4.417969 0-8 3.582031-8 8v80c0 4.417969 3.582031 8 8 8h288c4.417969 0 8-3.582031 8-8v-80c0-4.417969-3.582031-8-8-8zm-8 80h-272v-64h272zm0 0"/><path d="m343.917969 408.355469h16v16h-16zm0 0"/><path d="m311.917969 408.355469h16v16h-16zm0 0"/><path d="m279.917969 408.355469h16v16h-16zm0 0"/><path d="m247.917969 408.355469h16v16h-16zm0 0"/><path d="m215.917969 408.355469h16v16h-16zm0 0"/><path d="m343.917969 440.355469h16v16h-16zm0 0"/><path d="m311.917969 440.355469h16v16h-16zm0 0"/><path d="m279.917969 440.355469h16v16h-16zm0 0"/><path d="m247.917969 440.355469h16v16h-16zm0 0"/><path d="m215.917969 440.355469h16v16h-16zm0 0"/><path d="m183.917969 408.355469h16v16h-16zm0 0"/><path d="m183.917969 440.355469h16v16h-16zm0 0"/><path d="m143.917969 456.355469c13.253906 0 24-10.742188 24-24 0-13.253907-10.746094-24-24-24-13.253907 0-24 10.746093-24 24 0 13.257812 10.746093 24 24 24zm0-32c4.417969 0 8 3.582031 8 8s-3.582031 8-8 8-8-3.582031-8-8 3.582031-8 8-8zm0 0"/></g></svg>
                SuperDuperDrive
            </a>
            <div id="logoutDiv">
                <form action="#" th:action="@{/logout}" method="POST">
                    <button type="submit" class="btn btn-secondary float-right">Logout</button>
                </form>
            </div>
        </div>
    </nav>
        <div class="container">

            <div id="contentDiv" style="clear: right;">
                <nav style="clear: right;">
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a  class="nav-item nav-link active" id="nav-files-tab" data-toggle="tab" href="#nav-files" role="tab" aria-controls="nav-files" aria-selected="true">Files</a>
                        <a  class="nav-item nav-link" id="nav-notes-tab" data-toggle="tab" href="#nav-notes" role="tab" aria-controls="nav-notes" aria-selected="false">Notes</a>
                        <a  class="nav-item nav-link" id="nav-credentials-tab" data-toggle="tab" href="#nav-credentials" role="tab" aria-controls="nav-credentials" aria-selected="false">Credentials</a>
                    </div>
                </nav>

                <!-- Files -->
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-files" role="tabpanel" aria-labelledby="nav-files-tab">
                        <form action="#" th:action="@{/home/files}" enctype="multipart/form-data"  method="POST">
                            <div class="container">
                                <div class="row" style="margin: 1em;">
                                    <div class="col-sm-2">
                                        <label for="fileUpload">Upload a New File:</label>
                                    </div>
                                    <div class="col-sm-6">
                                        <input type="file" class="form-control-file" id="fileUpload" name="fileUpload" required>
                                    </div>
                                    <div class="col-sm-4">
                                        <button type="submit" class="btn btn-dark float-right">Upload</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="table-responsive">

                            <div th:if="${files.isEmpty() || files == null}" class="d-flex justify-content-center mt-5">
                               You have no files here, try uploading some !
                            </div>

                            <table  th:if="${!files.isEmpty() && files != null}" class="table table-striped" id="fileTable">
                                <thead>
                                    <tr >
                                        <th style="width: 20%" scope="col"></th>
                                        <th  style="width: 80%" scope="col">File Name</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <tr th:each="file:${files}">
                                    <td>
                                        <a th:href="@{home/files/view/{fileId}(fileId = ${file.fileId})}" target="_blank" class="btn btn-success">View</a>
                                        <a th:href="@{home/files/{fileId}(fileId = ${file.fileId})}" class="btn btn-danger">Delete</a>
                                    </td>
                                    <th th:text = ${file.filename} scope="row">ExampleFile.txt</th>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!--  Notes -->

                    <div class="tab-pane fade" id="nav-notes" role="tabpanel" aria-labelledby="nav-notes-tab">


                            <div class="w-100" style="height:50px">
                                <button style="margin: 0.25em;" type="button" class="btn btn-info float-right" onclick="showNoteModal()">
                                    + Add a New Note
                                </button>
                            </div>
                            <div th:if="${notes == null || notes.isEmpty()}" class="d-flex justify-content-center mt-5">
                                You have no notes here, try adding some !
                            </div>




                        <div th:if="${notes != null && !notes.isEmpty()}" class="table-responsive">
                            <table class="table table-striped" id="userTable">
                                <thead>
                                    <tr>
                                        <th style="width: 20%" scope="col"></th>
                                        <th style="width: 20%" scope="col">Title</th>
                                        <th style="width: 60%" scope="col">Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr  th:each="note: ${notes}">
                                        <td>
                                            <button type="button" class="btn btn-success" th:onclick="showNoteModal([[${note.noteid}]],[[${note.notetitle}]],[[${note.notedescription}]])">Edit</button>
                                            <a th:href="@{home/notes/{noteid}(noteid = ${note.noteid})}" class="btn btn-danger">Delete</a>
                                        </td>
                                        <th th:text="${note.notetitle}" scope="row"></th>
                                        <td th:text="${note.notedescription}"></td>
                                    </tr>
                                </tbody>

                            </table>
                        </div>

                        <div class="modal fade" id="noteModal" tabindex="-1" role="dialog" aria-labelledby="noteModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="noteModalLabel">Note</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form action="#" th:action="@{/home/notes}" th:object ="${note}" method="POST">
                                            <input type="hidden" th:field="*{noteid}" th:value="*{noteid}" name="noteId" id="note-id">
                                            <div class="form-group">
                                                <label for="note-title" class="col-form-label">Title</label>
                                                <input th:field="*{notetitle}" th:value="*{notetitle}" type="text" name= "noteTitle" class="form-control" id="note-title" maxlength="20" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="note-description" class="col-form-label">Description</label>
                                                <textarea   th:field="*{notedescription}" th:value="*{notedescription}" class="form-control" name="noteDescription" id="note-description" rows="5" maxlength="1000" required></textarea>
                                            </div>
                                            <button id="noteSubmit" type="submit" class="d-none"></button>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" onclick="$('#noteSubmit').click();">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

<!--                    Credentials -->

                    <div class="tab-pane fade" id="nav-credentials" role="tabpanel" aria-labelledby="nav-credentials-tab">
                        <button style="margin: 0.25em;" type="button" class="btn btn-info float-right" onclick="showCredentialModal()">
                            + Add a New Credential
                        </button>

                        <div class="table-responsive">

                            <div class="d-flex justify-content-center mt-5" th:if="${ credentials == null || credentials.isEmpty()}">
                                You have no credentials stored Here!
                            </div>
                            <table th:if="${ credentials !=null && !credentials.isEmpty()}" class="table table-striped" id="credentialTable">
                                <thead>
                                    <tr>
                                        <th style="width: 20%" scope="col"></th>
                                        <th style="width: 35%" scope="col">URL</th>
                                        <th style="width: 20%" scope="col">Username</th>
                                        <th style="width: 25%" scope="col">Password</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <tr th:each="credential:${credentials} ">
                                    <td>
                                        <button type="button" class="btn btn-success"
                                                th:onclick="showCredentialModal([[${credential.credentialid}]],[[${credential.url}]],[[${credential.username}]],[[${encryptionService.decryptValue(credential.password,credential.key)}]])">Edit</button>
                                        <a th:href="@{/home/credentials/{credentialid}(credentialid = ${credential.credentialid})}" class="btn btn-danger">Delete</a>
                                    </td>
                                    <th th:text="${credential.url}" scope="row">Example Credential URL</th>
                                    <td th:text="${credential.username}">Example Credential Username</td>
                                    <td th:text="${credential.password}">Example Credential Password</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="modal fade" id="credentialModal" tabindex="-1" role="dialog" aria-labelledby="credentialModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="credentialModalLabel">Credential</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <form th:action="@{/home/credentials}" th:object="${credential}" action="#" method="POST">
                                            <input type="hidden" th:field="*{credentialid}" th:value="*{credentialid}" name="credentialId" id="credential-id">
                                            <div class="form-group">
                                                <label for="note-title" class="col-form-label">URL</label>
                                                <input th:value="*{url}" th:field="*{url}" type="text" name= "url" class="form-control" id="credential-url" maxlength="100" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="note-title" class="col-form-label">Username</label>
                                                <input th:value="*{username}" th:field="*{username}"type="text" name= "username" class="form-control" id="credential-username" maxlength="30" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="note-title" class="col-form-label">Password</label>
                                                <input th:value="*{password}" th:field="*{password}" type="text" name= "password" class="form-control" id="credential-password" maxlength="30" required>
                                            </div>
                                            <button id="credentialSubmit" type="submit" class="d-none"></button>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" onclick="$('#credentialSubmit').click();">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script th:src="@{/js/jquery-slim.min.js}"></script>
        <script th:src="@{/js/popper.min.js}"></script>
        <script th:src="@{/js/bootstrap.min.js}"></script>

        <!--For opening the note modal-->
        <script type="text/javascript">
           // For opening the note modal
            function showNoteModal(noteId, noteTitle, noteDescription) {
                $('#note-id').val(noteId ? noteId : '');
                $('#note-title').val(noteTitle ? noteTitle : '');
                $('#note-description').val(noteDescription ? noteDescription : '');
                $('#noteModal').modal('show');
            }

             //For opening the credentials modal
            function showCredentialModal(credentialId, url, username, password) {
                $('#credential-id').val(credentialId ? credentialId : '');
                $('#credential-url').val(url ? url : '');
                $('#credential-username').val(username ? username : '');
                $('#credential-password').val(password ? password : '');
                $('#credentialModal').modal('show');
            }
        </script>
    </body>
</html>